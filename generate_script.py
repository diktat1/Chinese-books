#!/usr/bin/env python3
"""
Generate the beginner Japanese N5 script for Chapter 1 and validate it.

This script embeds the hand-crafted N5-level Japanese synthesis of
"Only the Paranoid Survive" Chapter 1 (Pentium bug crisis),
validates it against the JLPT N5 word list, and saves the result.
"""
import json
import warnings
import logging

warnings.filterwarnings('ignore')
logging.basicConfig(level=logging.INFO, format='%(asctime)s [%(levelname)s] %(message)s')

from graded_reader.beginner_japanese import validate_n5

# === BEGINNER JAPANESE SCRIPT (N5 VOCABULARY DRILL) ===
# Chapter 1: 我们这里出了什么事呢？ (What happened here?)
# Source: 只有偏执狂才能生存 (Only the Paranoid Survive) by Andy Grove
#
# Each pair: (Japanese sentence, Corresponding simplified Chinese)
# Uses ONLY JLPT N5 vocabulary, A1-A2 grammar, heavy repetition

PAIRS = [
    # --- Section 1: Introduction - Andy Grove, Intel, teaching ---
    ("これは会社の話です。", "这是一个公司的故事。"),
    ("大きい会社の話です。", "是一个大公司的故事。"),
    ("会社の名前はインテルです。", "公司的名字叫英特尔。"),
    ("インテルはとても大きい会社です。", "英特尔是一个非常大的公司。"),
    ("この人はグローブさんです。", "这个人是格鲁夫先生。"),
    ("グローブさんは会社の一番上の人です。", "格鲁夫先生是公司最高的人。"),
    ("グローブさんは毎日会社で仕事をします。", "格鲁夫先生每天在公司工作。"),
    ("グローブさんは学校でも仕事をします。", "格鲁夫先生也在学校工作。"),
    ("学校で学生に教えます。", "在学校教学生。"),
    ("学生はたくさんいます。", "有很多学生。"),

    # --- Section 2: The problem appears ---
    ("ある日、問題がありました。", "有一天，出现了问题。"),
    ("大きい問題がありました。", "出现了大问题。"),
    ("会社に大きい問題がありました。", "公司出现了大问题。"),
    ("会社のものに問題がありました。", "公司的东西出了问题。"),
    ("小さい問題でした。でも大きくなりました。", "本来是小问题。但是变大了。"),
    ("テレビの人が来ました。", "电视台的人来了。"),
    ("テレビの人は会社に来ました。", "电视台的人来到了公司。"),
    ("テレビの人はこの問題を知りたいです。", "电视台的人想要了解这个问题。"),
    ("テレビの人はとても「いやだ」と言いました。", "电视台的人非常不高兴。"),

    # --- Section 3: Intel background ---
    ("インテルは何の会社ですか。", "英特尔是什么公司？"),
    ("インテルはパソコンのものを作ります。", "英特尔做电脑的东西。"),
    ("とても大切なものを作ります。", "做非常重要的东西。"),
    ("会社はとても大きいです。", "公司非常大。"),
    ("お金がたくさんあります。", "有很多钱。"),
    ("毎年お金がもっとたくさんになります。", "每年钱变得更多。"),
    ("会社の人はたくさんいます。", "公司的人很多。"),
    ("みんな毎日仕事をします。", "大家每天工作。"),

    # --- Section 4: New product (Pentium) ---
    ("会社は新しいものを作りました。", "公司做了新的东西。"),
    ("新しいものの名前はペンティアムです。", "新东西的名字叫奔腾。"),
    ("ペンティアムはとても大切です。", "奔腾非常重要。"),
    ("ペンティアムは新しいです。", "奔腾是新的。"),
    ("たくさんの人がペンティアムを買いました。", "很多人买了奔腾。"),
    ("たくさんの会社がペンティアムを使います。", "很多公司使用奔腾。"),
    ("でも、ペンティアムに問題がありました。", "但是，奔腾有问题。"),

    # --- Section 5: The bug discovered ---
    ("先生がペンティアムの問題を分かりました。", "一位老师发现了奔腾的问题。"),
    ("先生は学校で仕事をする人です。", "老师是在学校工作的人。"),
    ("先生はパソコンを使いました。", "老师使用了电脑。"),
    ("パソコンが出した答えが違いました。", "电脑给出的答案不对了。"),
    ("少し違いました。", "错了一点点。"),
    ("先生はこのことをみんなに言いました。", "老师把这件事告诉了大家。"),
    ("みんなはこの問題を聞きました。", "大家听到了这个问题。"),

    # --- Section 6: Intel's initial reaction ---
    ("インテルはこの問題を前から知っていました。", "英特尔之前就知道这个问題。"),
    ("問題はとても小さいと思いました。", "觉得问题非常小。"),
    ("問題はあまり大きくないと思いました。", "觉得问题不太大。"),
    ("でも、問題は大きくなりました。", "但是，问题变大了。"),
    ("テレビと新聞がこの問題を言いました。", "电视和报纸说了这个问题。"),
    ("新聞にたくさん書いてありました。", "报纸上写了很多。"),
    ("テレビでたくさん言いました。", "在电视上说了很多。"),

    # --- Section 7: CNN arrives, crisis escalates ---
    ("テレビの人がインテルに来ました。", "电视台的人来到了英特尔。"),
    ("グローブさんはすぐ会社に行きました。", "格鲁夫先生马上去了公司。"),
    ("会社で電話がたくさん来ました。", "公司来了很多电话。"),
    ("問題は毎日大きくなりました。", "问题每天变大。"),
    ("新聞は毎日この問題を書きました。", "报纸每天写这个问题。"),
    ("テレビは毎日この問題を言いました。", "电视每天说这个问题。"),
    ("たくさんの人が「いやだ」と言いました。", "很多人不高兴了。"),

    # --- Section 8: Customer complaints ---
    ("お客さんが電話をかけました。", "客人打了电话。"),
    ("お客さんは新しいものがほしいです。", "客人想要新的东西。"),
    ("「新しいものをください」と言いました。", "说：请给我新的东西。"),
    ("インテルは「問題は小さいです」と言いました。", "英特尔说：问题很小。"),
    ("お客さんは「いいえ」と言いました。", "客人说：不行。"),
    ("お客さんはとても「いやだ」と思いました。", "客人非常不高兴。"),
    ("電話は毎日たくさん来ました。", "每天来很多电话。"),

    # --- Section 9: IBM stops shipments ---
    ("ある朝、新しい問題がありました。", "一天早上，出现了新问题。"),
    ("大きい会社が言いました。", "大公司说了。"),
    ("その大きい会社の名前はIBMです。", "那个大公司的名字是IBM。"),
    ("IBMはとても大きい会社です。", "IBM是非常大的公司。"),
    ("IBMはペンティアムを使いません。", "IBM不再使用奔腾了。"),
    ("これはとても大きいニュースでした。", "这是非常大的新闻。"),
    ("みんながこのニュースを聞きました。", "大家都听到了这个新闻。"),
    ("問題はもっと大きくなりました。", "问题变得更大了。"),
    ("もっとたくさんの人が電話をかけました。", "更多的人打了电话。"),

    # --- Section 10: Internal crisis ---
    ("会社の中の人もとても大変でした。", "公司里面的人也非常辛苦。"),
    ("みんなは毎日たくさん仕事をしました。", "大家每天做了很多工作。"),
    ("でも、よくありませんでした。", "但是，事情不顺利。"),
    ("みんなはとても疲れました。", "大家非常累了。"),
    ("家に帰っても、問題がありました。", "回到家里，也有问题。"),
    ("家の人がテレビを見ました。", "家人看了电视。"),
    ("テレビで会社の悪いニュースを見ました。", "在电视上看到了公司的坏消息。"),
    ("家の人は「どうしましたか」と聞きました。", "家人问：怎么了？"),
    ("会社の人はとても元気がなかったです。", "公司的人非常难过。"),
    ("グローブさんも毎日とても大変でした。", "格鲁夫先生也每天非常辛苦。"),

    # --- Section 11: Decision to change ---
    ("グローブさんは「どうしますか」と思いました。", "格鲁夫先生想：怎么办呢？"),
    ("会社は新しくしなければなりません。", "公司必须做出改变。"),
    ("インテルは新しいことをしました。", "英特尔做了新的事情。"),
    ("お客さんみんなに新しいものをあげました。", "给了所有客人新的东西。"),
    ("ほしい人はみんなもらいます。", "想要的人都可以拿到。"),
    ("これはとても大切なことでした。", "这是非常重要的事情。"),

    # --- Section 12: The cost ---
    ("でも、お金がたくさんかかりました。", "但是，花了很多钱。"),
    ("とてもたくさんのお金です。", "非常多的钱。"),
    ("五億ドルぐらいかかりました。", "大约花了五亿美元。"),
    ("五億ドルはとても多いお金です。", "五亿美元是非常多的钱。"),
    ("会社は新しい道を歩き始めました。", "公司开始走新的路。"),

    # --- Section 13: What changed? ---
    ("何が新しくなりましたか。", "什么变了？"),
    ("大きいことが新しくなりました。", "大的事情变了。"),
    ("前は、会社が「いい」と言いました。", "以前，公司说好的就可以了。"),
    ("でも今は違います。", "但是现在不一样了。"),
    ("お客さんの声がとても大切になりました。", "客人的声音变得非常重要了。"),
    ("お客さんはたくさんいます。", "客人有很多。"),
    ("お客さんはみんな「問題です」と言いました。", "客人都说：有问题。"),
    ("会社はお客さんの話を聞かなければなりません。", "公司必须听客人的话。"),

    # --- Section 14: Brand and size ---
    ("インテルはとても有名です。", "英特尔非常有名。"),
    ("みんながインテルの名前を知っています。", "大家都知道英特尔的名字。"),
    ("テレビでインテルの名前をよく見ます。", "在电视上经常看到英特尔的名字。"),
    ("有名だから、問題も大きくなりました。", "因为有名，问题也变大了。"),
    ("大きい会社だから、みんなが見ています。", "因为是大公司，大家都在看。"),
    ("前は小さい会社でした。問題も小さかったです。", "以前是小公司。问题也很小。"),
    ("でも今は大きい会社です。", "但是现在是大公司。"),
    ("だから、小さい問題も大きくなります。", "所以，小问题也会变大。"),

    # --- Section 15: The boss is last to know ---
    ("大切なことがあります。", "有重要的事情。"),
    ("上の人は一番後で知ります。", "上面的人最后才知道。"),
    ("会社の上の人は問題を一番後で聞きます。", "公司上面的人最后听到问题。"),
    ("下の人が先に知ります。", "下面的人先知道。"),
    ("下の人は毎日お客さんと話します。", "下面的人每天和客人说话。"),
    ("だから、下の人は先に分かります。", "所以，下面的人先明白。"),
    ("でも、上の人に言うのは難しいです。", "但是，告诉上面的人很难。"),
    ("上の人はあまり聞きません。", "上面的人不太愿意听。"),

    # --- Section 16: Lesson learned ---
    ("グローブさんも一番後で分かりました。", "格鲁夫先生也是最后才明白的。"),
    ("みんなの声を聞かなければなりません。", "必须要听大家的声音。"),
    ("お客さんの声を聞いてください。", "请听客人的声音。"),
    ("会社の人の声を聞いてください。", "请听公司人的声音。"),
    ("新聞の人の声を聞いてください。", "请听报纸的人的声音。"),
    ("新しくすることはとても大切です。", "改变是非常重要的。"),
    ("早く新しくしなければなりません。", "必须早点改变。"),
    ("新しくしないと、会社は悪くなります。", "不改变的话，公司会变差。"),
    ("新しくしたら、会社はよくなります。", "改变了的话，公司会变好。"),
    ("これがグローブさんの話です。", "这就是格鲁夫先生的故事。"),
    ("これがインテルの話です。", "这就是英特尔的故事。"),
]

# === VALIDATION ===
print(f"Total sentence pairs: {len(PAIRS)}")
print()

# Validate all Japanese text
all_jp = '\n'.join(jp for jp, _ in PAIRS)
report = validate_n5(all_jp)

print(f"N5 Validation Results:")
print(f"  Total content tokens: {report['total_tokens']}")
print(f"  Violations: {report['violation_count']}")
print(f"  Is valid (all N5): {report['is_valid']}")

if report['violations']:
    unique = {}
    for v in report['violations']:
        key = v['word']
        if key not in unique:
            unique[key] = v
    print(f"\n  Non-N5 words found ({len(unique)} unique):")
    for word, info in unique.items():
        print(f"    {word} (base: {info['base_form']}, reading: {info['reading']})")

# Show the full script
print("\n" + "=" * 60)
print("FULL SCRIPT — Beginner Japanese N5 Vocabulary Drill")
print("Chapter: 我们这里出了什么事呢？")
print("=" * 60)
for i, (jp, cn) in enumerate(PAIRS, 1):
    print(f"\n{i:3d}. JP: {jp}")
    print(f"     CN: {cn}")

# Save to JSON
output = {
    "chapter_title": "我们这里出了什么事呢？",
    "source_book": "只有偏执狂才能生存 (Only the Paranoid Survive)",
    "sentence_pairs": [{"japanese": jp, "chinese": cn} for jp, cn in PAIRS],
    "validation": {
        "total_tokens": report["total_tokens"],
        "violation_count": report["violation_count"],
        "violations": list({v["word"] for v in report["violations"]}),
    }
}

with open("beginner_japanese_script.json", "w", encoding="utf-8") as f:
    json.dump(output, f, ensure_ascii=False, indent=2)

print(f"\n\nScript saved to beginner_japanese_script.json")
